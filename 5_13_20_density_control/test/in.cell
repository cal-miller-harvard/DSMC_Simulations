# 2d axial simulation of CBGB cell

echo screen

# variables to be set in RunCells.jl
variable FNUM equal "1.000E+12"
variable ZMAX equal "3.500E-01"
variable RMAX equal "3.000E-02"
variable TIMESTEP equal "1.000E-06"
variable NPERSTEP equal "3.000E+00"

global		        fnum ${FNUM} cellmax 10000
seed	    	    12345
dimension   	    2
units               si
timestep 	        ${TIMESTEP}

species		        he4.species He4
mixture		        He4 He4 nrho 1 vstream 26.2 0 0 temp 2.0
collide             vss He4 He4.vss #kk

# read_restart data/cell.restart.*

boundary	        o ao p
create_box  	    0 ${ZMAX} 0 ${RMAX} -0.1 0.1
create_grid 	    20 20 1 
balance_grid        rcb cell

read_surf           data.cell
group       inlet surf id 12
fix		    in emit/surf He4 inlet n ${NPERSTEP} perspecies no

read_surf           data.diffuser

read_surf           data.stages trans 65.09E-3 0 0

surf_collide	    diffuse diffuse 2.0 1.0
surf_modify         all collide diffuse

stats		    1000
stats_style	    wall step cpu np nattempt ncoll nscoll nscheck

# Run until convergence
label loop
variable a loop 40
run 		    10000
adapt_grid all refine particle 16 4
balance_grid rcb part
next a
jump in.cell loop

compute temp thermal/grid all He4 temp
compute rhov grid all He4 nrho massrho u v w
fix out ave/grid all 1000 100 100000 c_temp[*] c_rhov[*]
dump out grid all 100000 data/DS2FF.*.DAT xc yc f_out[*]

# Record statistics
label loop2
variable b loop 11
run 		    10000

next b
jump in.cell loop2

# Save surfaces
dump surfs surf all 1 data/cell.*.surfs id v1x v1y v2x v2y
run 1